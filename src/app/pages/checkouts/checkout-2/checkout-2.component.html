

@if (isHydrated && !carts?.length) {
  <div class="empty-cart">
    <app-empty-data
      [needBorder]="false"
      [iconWidth]="'280px'"
      [title]="'Your Checkout is Empty!'"
      [titleSize]="'20px'"
      [desc]="'You don’t have any items to checkout. Please add some products first.'"
      [filePath]="'/lottie/no-data-1.json'"
      [btnTitle]="'Continue Shopping'"
      [btnUrl]="'/products'">
    </app-empty-data>
  </div>
} @else {

<!--  [cityName]="deliveryCharge?.city"-->
  <div class="main-area">
    <div class="container">
      <div class="checkout-area">
        <div>
          <app-offers></app-offers>
          <app-address-area-2 (formData)="onChangeAddress($event)"
                              [user]="user"
                              [deliveryCharge]="deliveryCharge"
                              [needRefreshForm]="needRefreshForm"
                              [deliveryOptionType]="deliveryOptionType"
                              [productSetting]="productSetting"
          ></app-address-area-2>

          @if(isEnableOrderNote){
            <form [formGroup]="dataForm">
              <div class="form-input-select full-note">
                <mat-form-field class="mat-input-field" appearance="outline">
                  <mat-label>{{ 'placeHolderNotes'  | translate }}</mat-label>
                  <textarea matInput formControlName="deliveryNote"
                            placeholder="{{ 'placeHolderNotes'  | translate }}"></textarea>
                </mat-form-field>
              </div>
            </form>
          }

<!--          @if(isEnableAdvancePayment){-->
<!--            <div class="advance-payment-area">-->
<!--              <button type="button" class="advance-btn" (click)="openAdvancePaymentDialog({})">Pay Advance</button>-->
<!--            </div>-->
<!--          }-->

          <div class="payment-area">
          <div class="payment-option">
            <app-delivery-charge (onChangeDeliveryCharge)="onChangeDeliveryCharge($event)"
                                 [division]="division"></app-delivery-charge>
          </div>


            <app-payment-method
              (onChangePaymentMethod)="onChangePaymentMethod($event)"
              (onChangePaymentType)="onChangePaymentType($event)"
              (allPaymentMethod)="allPaymentMethod($event)"
                                [userOfferDiscount]="userOfferDiscount">
            </app-payment-method>
          </div>
        </div>
        <div>
          <div class="order-area">
            <app-title [title]="('orderItems'  | translate) + ' (' + carts.length + ' Items)'"></app-title>
            <div class="order-items pc-card">
              @for (item of carts; track item; let i = $index) {
                <app-order-item-card
                  [data]="item"
                  (onIncrementCartQty)="onIncrementQty(item?._id, i)"
                  (onDecrementCartQty)="onDecrementQty(item?._id, i, item.selectedQty)">
                </app-order-item-card>
              }
            </div>

            <div class="order-items mobile-card">
              @for (item of carts; track item; let i = $index) {
                <app-order-item-card-mobile
                  [data]="item"
                  (onIncrementCartQty)="onIncrementQty(item?._id, i)"
                  (onDecrementCartQty)="onDecrementQty(item?._id, i, item.selectedQty)">
                </app-order-item-card-mobile>
              }
            </div>

            <div class="summary">
              <div class="summary-item">
                <div class="label">{{ 'subTotal'  | translate }}:</div>
                <div class="value">{{ (cartRegularSubTotal) | currencyCtr }}</div>
              </div>
              <div class="summary-item">
                <div class="label">{{ 'discount'  | translate }}:</div>
                <div class="value">-{{ (cartDiscountAmount) | currencyCtr }}</div>
              </div>
              @if (userOfferDiscount) {
                <div class="summary-item">
                  <div class="label">{{ userOfferDiscount?.name }}:</div>
                  <div class="value">-{{ userOfferDiscount?.amount | currencyCtr}}</div>
                </div>
              }
              <div class="summary-item border-bottom ">
                <div class="label">{{ 'deliveryCharge'  | translate }}:</div>
                <div class="value">{{ ((deliveryChargeAmount) | currencyCtr) ?? 0 }}</div>
              </div>





              <div class="summary-item grand-total border-bottom">
                <div class="label grand-total">{{ 'grandTotal'  | translate }}:</div>
                <div class="value">{{ (grandTotal) | currencyCtr }}</div>
              </div>

<!--              coupon section-->

              @if (!isCoupon){
                <div class="coupon-div">
                  <button class="coupon-btn" (click)="onSelectCouponOpen()">{{ 'haveCoupon'  | translate }}</button>

                </div>

              } @else {

                <div class="close-btn-div">
                  <button class="close-btn" (click)="onSelectCouponClose()">x</button>

                </div>

                <div class="summary-item ">
                  <div class="coupon-area">
                    <div class="coupon-input">
                      <input
                        [readOnly]="coupon"
                        [(ngModel)]="couponCode"
                        type="text"
                        placeholder="Have coupon any code? Enter Here.."
                      />
                    </div>

                    @if (!coupon){
                      <div
                        class="apply-btn"
                        (click)="checkCouponAvailability()"
                      >
                        <button>Apply</button>
                      </div>
                    } @else {
                      <div

                        class="apply-btn"
                        (click)="onRemoveCoupon()"
                      >
                        <button class="danger">Remove</button>
                      </div>
                    }



                  </div>
                </div>

              }

            </div>
          </div>
          <!-- END! Cart Item and Calculation Area -->

          @if (userService.isUser) {
            <app-user-offers [cartSaleSubTotal]="cartSaleSubTotal"
                             (onChangeUserDiscount)="onChangeUserDiscount($event)"></app-user-offers>
          }
          <div class="button-area">
            <button class="back-button" routerLink="/cart">
              <svg height="30" viewBox="0 0 48 48" width="30" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 0h48v48h-48z" fill="none"/>
                <path d="M40 22h-24.34l11.17-11.17-2.83-2.83-16 16 16 16 2.83-2.83-11.17-11.17h24.34v-4z"/>
              </svg>
              <span>{{ 'backToCart'  | translate }}</span>
            </button>
            @if (!isLoading) {
              <button class="order-button" (click)="onConfirmOrder()">
                <svg height="30px" id="Layer_1" style="enable-background:new 0 0 512 512;" version="1.1"
                     viewBox="0 0 512 512" width="30px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"
                ><g><path d="M223.9,329.7c-2.4,2.4-5.8,4.4-8.8,4.4s-6.4-2.1-8.9-4.5l-56-56l17.8-17.8l47.2,47.2l124.8-125.7l17.5,18.1L223.9,329.7z"/></g></svg>
                <span>{{ 'confirmOrder'  | translate }}</span>
              </button>
            }
            @if (isLoading) {
              <button type="button" class="order-button wait-btn">
                <div><span class="loader btn-loader"></span></div>
                <div>{{ 'pleaseWait'  | translate }}</div>
              </button>
            }
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="bottom-nav">
    <div class="mobile-checkout">
      <div class="total-area">
        <p class="total">{{ 'total'  | translate }}: <span>{{ grandTotal }}</span></p>
        <p class="button-text">{{ 'vatIncluded'  | translate }}</p>
      </div>
      @if (!isLoading) {
        <button class="place-order" (click)="onConfirmOrder()">{{ 'placeOrder'  | translate }}</button>
      }
      @if (isLoading) {
        <button type="button" class="order-button wait-btn">
          <div><span class="loader btn-loader"></span></div>
          <div>{{ 'pleaseWait'  | translate }}</div>
        </button>
      }
    </div>
  </div>

}

<!--@if (isSendOtp) {-->
<!--  <div class="otp-popup-backdrop">-->
<!--    <div class="otp-popup">-->
<!--      <h3>দয়া করে আপনার ফোন নাম্বারে একটি OTP Code গেছে সেটা দিয়ে অর্ডার কনফার্ম করুন।</h3>-->
<!--      <div class="input-otp">-->
<!--        <app-otp-input (onFinalInput)="onOtpEnter($event)" [isInvalid]="isInvalidOtp"></app-otp-input>-->
<!--      </div>-->
<!--      <div class="error-text" *ngIf="isInvalidOtp">ভুল ওটিপি! আবার চেষ্টা করুন।</div>-->

<!--      <div class="resend-section">-->
<!--        <button *ngIf="countdown <= 0"  (click)="onResendOtp()">-->
<!--          পুনরায় পাঠান-->
<!--        </button>-->
<!--        <span *ngIf="countdown > 0">{{ countdown }} সেকেন্ড</span>-->
<!--      </div>-->

<!--      <div class="button-row">-->
<!--        <button type="button" class="cancel-btn" (click)="closePopup()">বাতিল</button>-->
<!--        <button type="button" (click)="onConfirmOrder()">সাবমিট</button>-->
<!--      </div>-->
<!--    </div>-->
<!--  </div>-->
<!--}-->
